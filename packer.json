{
  "builders": [
    {
      "type": "arm-image",
      "iso_url": "{{user `iso_url`}}",
      "iso_checksum_type": "sha256",
      "iso_checksum": "{{user `iso_checksum`}}",
      "output_directory": "build",
      "target_image_size": "{{user `target_image_size`}}"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "inline": ["touch /boot/ssh"]
    },
    {
      "type": "shell",
      "inline": [
        "wpa_passphrase \"{{user `wifi_name`}}\" \"{{user `wifi_password`}}\"  >> /etc/wpa_supplicant/wpa_supplicant.conf"
      ]
    },
    {
      "type": "shell",
      "inline": [
        "sudo apt-get update",
        "sudo apt-get --yes upgrade",
        "sudo apt-get --yes dist-upgrade"
      ]
    },
    {
      "type": "shell",
      "inline": [
	"sudo raspi-config nonint do_change_timezone Australia/Sydney",
        "sudo raspi-config nonint do_wifi_country AU"
      ]
    },
    {
      "type": "shell-local",
      "command": "ls /"
    }
  ],
  "variables": {
    "iso_checksum": "9e5cf24ce483bb96e7736ea75ca422e3560e7b455eee63dd28f66fa1825db70e",
    "iso_url": "https://downloads.raspberrypi.org/raspbian_lite/images/raspbian_lite-2019-07-12/2019-07-10-raspbian-buster-lite.zip",
    "target_image_size": 34359738368,
    "wifi_name": "",
    "wifi_password": ""
  }
}
